(()=>{"use strict";const e={main:{Math:[1,2,3,4],Eco:[1,4],Crafts:[1],PE:[1,2,3],Finnish:[2,3,4,5],History:[2],Music:[2],English:[3,4],Ethics:[3],Art:[5],Civics:[5],Digi:[5]},alternative:{}},t={math:"#4361ee",finnish:"#4cc9f0",english:"#f72585",history:"#7209b7",civics:"#3a0ca3",ethics:"#4895ef",pe:"#560bad",music:"#b5179e",art:"#f15bb5",crafts:"#fee440",eco:"#06d6a0",digi:"#118ab2"};function n(t,n=e){const o=(new Date).getDay(),s=0===o?7:o,a=t.toLowerCase(),r=n.main,i=Object.keys(r).find((e=>e.toLowerCase()===a));if(!i)return console.warn(`Subject ${t} not found in the schedule`),{found:!1,daysUntil:null,nextDay:null,dayName:null};const c=r[i];if(!c||!c.length)return console.warn(`No class days defined for subject ${t}`),{found:!1,daysUntil:null,nextDay:null,dayName:null};const l=[...c].sort(((e,t)=>e-t));let d=null,u=1/0;for(const e of l)if(e>s){d=e,u=e-s;break}return null===d&&(d=l[0],u=7-s+d),{found:!0,daysUntil:u,nextDay:d,dayName:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][7===d?0:d]}}const o={global:[],paths:{},events:{}};let s={students:[],tasks:[],activeFilter:"all",filteredLists:{},showRecentOnly:!1,lastScrollPosition:0,showArchive:!1,streak:{count:0,target:7,lastActive:null}};function a(){return{...s}}function r(e,t="unknown"){const n={...s};s="function"==typeof e?{...s,...e(s)}:{...s,...e};const r=l(n,s);return function(e,t,n,r){o.global.forEach((o=>{try{o(t,e,{changedPaths:n,source:r})}catch(e){console.error("Error in global state subscriber:",e)}})),n.length>0&&Object.keys(o.paths).forEach((t=>{if(n.some((e=>e===t||e.startsWith(`${t}.`)||t.startsWith(`${e}.`)))){const n=function(e){return e?e.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),s):a()}(t),i=t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),e);o.paths[t].forEach((e=>{try{e(n,i,{path:t,source:r})}catch(e){console.error(`Error in path subscriber for ${t}:`,e)}}))}}))}(n,s,r,t),{...s}}function i(e,t={}){if(!e||"function"!=typeof e)return console.error("Invalid subscriber callback"),()=>{};const{path:n,event:s}=t;return n?(o.paths[n]||(o.paths[n]=[]),o.paths[n].push(e),()=>{o.paths[n]=o.paths[n].filter((t=>t!==e))}):s?(o.events[s]||(o.events[s]=[]),o.events[s].push(e),()=>{o.events[s]=o.events[s].filter((t=>t!==e))}):(o.global.push(e),()=>{o.global=o.global.filter((t=>t!==e))})}function c(e,t){e?o.events[e]&&o.events[e].forEach((n=>{try{n(t,e)}catch(t){console.error(`Error in event subscriber for ${e}:`,t)}})):console.error("Event name is required")}function l(e,t,n="",o=[]){if(typeof e!=typeof t)return o.push(n),o;if("object"!=typeof e||null===e||null===t)return e!==t&&o.push(n),o;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return o.push(n),o;for(let s=0;s<e.length;s++)if(JSON.stringify(e[s])!==JSON.stringify(t[s]))return o.push(n),o;return o}return new Set([...Object.keys(e),...Object.keys(t)]).forEach((s=>{const a=n?`${n}.${s}`:s;s in e&&s in t?l(e[s],t[s],a,o):o.push(a)})),o}let d=null,u=null,m=!1,h=null;function f(){return h||(h=new Promise(((e,t)=>{if(m&&u&&d)return console.log("Firebase already initialized and available"),void e({db:u,modules:d});if(window.db&&window.firebaseModules)return console.log("Firebase already initialized by index.html"),u=window.db,d=window.firebaseModules,m=!0,void e({db:u,modules:d});console.log("Waiting for Firebase to initialize...");const n=()=>{console.log("Firebase ready event received"),window.db&&window.firebaseModules?(u=window.db,d=window.firebaseModules,m=!0,clearTimeout(o),e({db:u,modules:d})):(console.error("Firebase ready event received but modules not available"),clearTimeout(o),t(new Error("Firebase initialized but modules not available")))};window.addEventListener("firebase-ready",n,{once:!0});const o=setTimeout((()=>{if(window.removeEventListener("firebase-ready",n),!window.db||!window.firebaseModules){console.error("Firebase initialization timed out after 8 seconds");try{document.getElementById("loading-indicator").innerHTML='\n            <div class="error-message">\n              <p>Connection to database timed out. Please check your internet connection.</p>\n              <button onclick="location.reload()" class="primary-btn">Retry</button>\n            </div>\n          '}catch(e){console.error("Could not update loading indicator:",e)}t(new Error("Firebase initialization timed out"))}}),8e3)})),h)}const p=new Map;function y(e=null){e?p.delete(e):p.clear()}function g(e,t=null){return t?`${e}:${JSON.stringify(t)}`:e}async function v(e,t={}){await f();const{useCache:n=!0,cacheTTL:o=6e4}=t,s=g(e);if(n&&p.has(s)){const e=p.get(s);if(e.expiry>Date.now())return[...e.data];p.delete(s)}try{const{collection:t,getDocs:a}=d,r=(await a(t(u,e))).docs.map((e=>({id:e.id,...e.data()})));return n&&p.set(s,{data:r,expiry:Date.now()+o}),r}catch(t){throw console.error(`Error fetching collection ${e}:`,t),t}}async function b(e,t,n){await f();try{const{doc:o,updateDoc:s}=d,a=o(u,e,t);return await s(a,n),y(g(`${e}/${t}`)),y(g(e)),{id:t,...n}}catch(n){throw console.error(`Error updating document ${t} in ${e}:`,n),n}}function w(){const e=new Date;return`${e.getDate().toString().padStart(2,"0")}.${(e.getMonth()+1).toString().padStart(2,"0")}.${e.getFullYear()}`}function k(e){if(!e||"string"!=typeof e)return console.error("Invalid date format received:",e),new Date;try{/^\d{1,2}\.\d{1,2}\.\d{4}$/.test(e)||console.warn("Date format does not match DD.MM.YYYY:",e);const[t,n,o]=e.split(".").map((e=>parseInt(e,10)));if(!(t>=1&&t<=31&&n>=1&&n<=12&&o>=1e3&&o<=9999))return console.error("Invalid date components:",{day:t,month:n,year:o}),new Date;const s=new Date(o,n-1,t);return s.getDate()!==t&&console.warn("Date was adjusted by browser:",{original:e,adjusted:`${s.getDate()}.${s.getMonth()+1}.${s.getFullYear()}`}),s}catch(t){return console.error("Error parsing date:",t,e),new Date}}function E(e,t){const n=k(e),o=k(t);return n.setHours(0,0,0,0),o.setHours(0,0,0,0),n<o?-1:n>o?1:0}async function $(e={useCache:!0}){try{const t=await v("tasks",e);return r({tasks:t},"taskService.loadTasks"),c("tasks-loaded",t),t}catch(e){throw console.error("Error loading tasks:",e),e}}async function C(e={useCache:!0}){try{const t=await v("students",e);return r({students:t},"taskService.loadStudents"),c("students-loaded",t),t}catch(e){throw console.error("Error loading students:",e),e}}function T(e){e.classList.add("celebrate-pulse"),setTimeout((()=>{e.classList.remove("celebrate-pulse")}),1500)}function D(e,n){const o=document.createElement("div");if(o.className="quest-card "+(e.completed?"completed-quest":""),o.dataset.id=e.id,o.dataset.type=e.type||"unknown",o.innerHTML=function(e){const n=e.subject?function(e){const n=e.toLowerCase();if(t[n])return t[n];{let e=0;for(let t=0;t<n.length;t++)e=n.charCodeAt(t)+((e<<5)-e);let t="#";for(let n=0;n<3;n++)t+=("00"+(e>>8*n&255).toString(16)).substr(-2);return t}}(e.subject):"#6c757d",o=e.subject?`border-left: 4px solid ${n};`:"",s=e.points?`${e.points} pts`:"";return`\n    <div class="quest-card-inner" style="${o}">\n      <div class="quest-card-content">\n        <div class="quest-card-header">\n          ${e.subject?`<div class="quest-subject" style="background-color: ${n};">${e.subject}</div>`:""}\n          ${"chore"===e.type?'<div class="quest-type">Chore</div>':""}\n          ${e.completed?'<div class="completed-stamp">DONE</div>':""}\n        </div>\n        <div class="quest-description">${e.description}</div>\n        <div class="quest-meta">\n          ${s?`<div class="quest-points">${s}</div>`:""}\n          ${e.completed&&e.completedDate?`<div class="quest-completed-date">Completed: ${e.completedDate}</div>`:""}\n        </div>\n      </div>\n      ${e.completed?"":'\n        <button class="complete-btn" aria-label="Complete task">\n          <i class="ri-check-line"></i>\n        </button>\n      '}\n    </div>\n  `}(e),!e.completed){const t=o.querySelector(".complete-btn");t&&t.addEventListener("click",(async s=>{s.preventDefault(),s.stopPropagation(),t.disabled=!0;try{await async function(e){try{const t=a(),{tasks:n,students:o}=t,s=n.findIndex((t=>t.id===e));if(-1===s)throw new Error(`Task with ID ${e} not found`);const i=n[s],l=w(),d={...i,completed:!0,completedDate:l,updatedAt:Date.now()};if(await b("tasks",e,{completed:!0,completedDate:l,updatedAt:Date.now()}),o&&o.length>0){const e=o[0],t=(e.points||0)+(i.points||0);await b("students",e.id,{points:t,updatedAt:Date.now()}),r({students:o.map((n=>n.id===e.id?{...n,points:t}:n))},"taskService.completeTask")}const u=[...n];return u[s]=d,r({tasks:u},"taskService.completeTask"),c("task-completed",d),d}catch(e){throw console.error("Error completing task:",e),e}}(e.id),await async function(e){return new Promise((t=>{const n=e.getBoundingClientRect(),o=e.cloneNode(!0);o.style.position="fixed",o.style.left=`${n.left}px`,o.style.top=`${n.top}px`,o.style.width=`${n.width}px`,o.style.height=`${n.height}px`,o.style.margin="0",o.style.zIndex="1000",o.style.transition="transform 0.5s ease, opacity 0.5s ease",o.style.pointerEvents="none",document.body.appendChild(o),e.classList.add("completed-quest");const s=document.createElement("div");s.className="completed-stamp",s.textContent="DONE",e.appendChild(s),o.offsetWidth,o.style.transform="scale(1.05)",o.style.opacity="0",setTimeout((()=>{o.remove(),t()}),500)}))}(o),n&&"function"==typeof n&&n(e.id)}catch(e){console.error("Error completing task:",e),t.disabled=!1}}))}return o}let S=null,L=null;let M=null,I=null;function x(e){try{localStorage.setItem("streak",JSON.stringify(e))}catch(e){console.error("Error saving streak data to localStorage:",e)}}function q(){const{streak:e}=a();let{count:t,target:n,lastActive:o}=e;const s=new Date,i=s.toDateString();if(!o){const e={count:1,target:n||7,lastActive:i};return r({streak:e},"streakTracker.updateStreak"),x(e),e}if(o===i)return e;const c=new Date(o),l=Math.abs(s-c);let d=t;Math.ceil(l/864e5)<=1?(d=t+1,d%n==0?N(d):3===d&&N(3,"small")):(d=1,console.log("Starting a new streak!"));const u={count:d,target:n||7,lastActive:i};return r({streak:u},"streakTracker.updateStreak"),x(u),u}function N(e,t="normal"){!function(){const e=document.getElementById("confetti")||document.body,t=["#4361ee","#4895ef","#f72585","#4cc9f0","#3a0ca3"];for(let n=0;n<150;n++){const n=document.createElement("div");n.className="confetti-piece",n.style.position="absolute",n.style.zIndex="100",n.style.width=10*Math.random()+5+"px",n.style.height=5*Math.random()+3+"px",n.style.backgroundColor=t[Math.floor(Math.random()*t.length)],n.style.opacity=Math.random()+.5,n.style.borderRadius="2px",n.style.pointerEvents="none";const o=e.offsetWidth/2,s=-20,a=15*(2*Math.random()-1),r=5*(2*Math.random()+2);n.style.left=`${o}px`,n.style.top=`${s}px`,e.appendChild(n);const i=e.offsetHeight;let c=o,l=s,d=a,u=r,m=0;const h=()=>{c+=d,l+=u,u+=.5,d*=.925,u>5&&(u=5),m+=10*Math.random(),n.style.transform=`translate(${d}px, ${u}px) rotate(${m}deg)`,n.style.left=`${c}px`,n.style.top=`${l}px`,l<i?requestAnimationFrame(h):setTimeout((()=>{n.remove()}),100)};setTimeout((()=>{requestAnimationFrame(h)}),500*Math.random())}}();const n=document.querySelector(".streak-tracker"),o=document.getElementById("streakCount");if(n&&T(n),o&&T(o),"small"!==t&&e>=7){const t=document.createElement("div");t.className="streak-celebration";let n="";n=e>=30?`Amazing! ${e} day streak!`:e>=14?`Fantastic! ${e} day streak!`:`${e} day streak! Keep it up!`,t.innerHTML=`\n      <div class="streak-message">\n        <i class="ri-award-fill"></i>\n        <h3>${n}</h3>\n        <p>You're building a great habit!</p>\n      </div>\n    `,document.body.appendChild(t),t.offsetWidth,t.classList.add("visible"),setTimeout((()=>{t.classList.remove("visible"),setTimeout((()=>t.remove()),500)}),4e3)}}function B(e){!function(e){if(!M||!I)return void console.error("Streak tracker elements not initialized. Call initStreakTracker first.");const{count:t,target:n}=e;M.textContent=t||"0";const o=Math.min(100,Math.floor(t/n*100));I.style.width=`${o}%`,I.className="streak-bar",o>=100?I.classList.add("streak-complete"):o>=75?I.classList.add("streak-near-complete"):o>=50?I.classList.add("streak-halfway"):o>=25&&I.classList.add("streak-starting")}(e)}let A=null,j=null,F=null,P=null,O=null,H=null;function Y(){A&&(A.style.display="flex",O&&(O.focus(),O.value=""),H&&(H.value="5"),document.body.style.overflow="hidden")}function z(){A&&(A.style.display="none",document.body.style.overflow="")}async function R(){if(!O||!H)return;const e=O.value.trim(),t=parseInt(H.value,10);if(!e)return O.classList.add("error"),void setTimeout((()=>O.classList.remove("error")),800);(isNaN(t)||t<1)&&(H.value="5"),P&&(P.disabled=!0,P.innerHTML='<i class="ri-loader-4-line rotating"></i> Adding...');try{await async function(e){try{if(!e.description||!e.points)throw new Error("Chore description and points are required");const t=Date.now(),n=w(),o={description:e.description,assignDate:n,dueDate:n,points:parseInt(e.points),completed:!1,type:"chore",createdAt:t,updatedAt:t},s=`chore_${t}`;await async function(e,t,n){await f();try{const{doc:o,setDoc:s}=d,a=o(u,e,t);return await s(a,n),y(g(`${e}/${t}`)),y(g(e)),{id:t,...n}}catch(n){throw console.error(`Error setting document ${t} in ${e}:`,n),n}}("tasks",s,o);const i={id:s,...o};return r({tasks:[...a().tasks||[],i]},"taskService.addChore"),c("task-added",i),i}catch(e){throw console.error("Error adding chore:",e),e}}({description:e,points:t||5}),z(),U("Chore added successfully!","success")}catch(e){console.error("Error adding chore:",e),U("Failed to add chore. Please try again.","error")}finally{P&&(P.disabled=!1,P.innerHTML="Add Chore")}}function U(e,t="info"){let n=document.getElementById("notifications");n||(n=document.createElement("div"),n.id="notifications",n.className="notification-container",document.body.appendChild(n));const o=document.createElement("div");o.className=`notification ${t}`,o.innerHTML=`\n    <div class="notification-content">\n      <p>${e}</p>\n    </div>\n  `,n.appendChild(o),o.offsetWidth,o.classList.add("visible"),setTimeout((()=>{o.classList.remove("visible"),setTimeout((()=>o.remove()),300)}),3e3)}const W={todayQuests:document.getElementById("today-quests"),todayEmptyState:document.getElementById("today-empty-state"),questContainer:document.getElementById("quest-container"),noQuestsMessage:document.getElementById("no-quests"),studentNameEl:document.getElementById("studentName"),studentPointsEl:document.getElementById("studentPoints"),loadingIndicator:document.getElementById("loading-indicator"),filterButtons:document.querySelectorAll(".filter-btn"),recentFilterText:document.getElementById("recentText"),streakCount:document.getElementById("streakCount"),streakBar:document.getElementById("streakBar"),addChoreBtn:document.getElementById("addChoreBtn"),choreModal:document.getElementById("choreModal"),closeModalBtn:document.getElementById("closeModal"),addChoreSubmitBtn:document.getElementById("addChoreSubmit"),choreDescriptionInput:document.getElementById("choreDescription"),chorePointsInput:document.getElementById("chorePoints"),archiveIndicator:null,archiveToggle:null};function J(e){W.loadingIndicator?W.loadingIndicator.style.display=e?"flex":"none":console.warn("Loading indicator element not found")}async function Q(){!function(){if(document.getElementById("animation-styles"))return;const e=document.createElement("style");e.id="animation-styles",e.textContent="\n    @keyframes bounce {\n      0%, 20%, 50%, 80%, 100% {transform: translateY(0);}\n      40% {transform: translateY(-20px);}\n      60% {transform: translateY(-10px);}\n    }\n    \n    .bounce {\n      animation: bounce 1s ease;\n    }\n    \n    @keyframes celebratePulse {\n      0% {transform: scale(1);}\n      25% {transform: scale(1.1);}\n      50% {transform: scale(1);}\n      75% {transform: scale(1.05);}\n      100% {transform: scale(1);}\n    }\n    \n    .celebrate-pulse {\n      animation: celebratePulse 1.5s ease;\n    }\n  ",document.head.appendChild(e)}();try{const e=localStorage.getItem("scrollPosition");null!==e&&setTimeout((()=>{window.scrollTo(0,parseInt(e,10))}),100)}catch(e){console.error("Error accessing localStorage:",e)}try{!function(){try{const e=localStorage.getItem("streak");if(e){const t=JSON.parse(e);return r({streak:t},"streakTracker.loadStreakData"),t}}catch(e){console.error("Error loading streak data from localStorage:",e)}a().streak}()}catch(e){console.error("Error in initial streak setup:",e)}J(!0);try{await f(),await Promise.all([$(),C()]),S=(e=W).todayQuests,L=e.todayEmptyState,S&&L||console.error("Today tasks elements not found"),function(e){M=e.streakCount,I=e.streakBar,M&&I?i(B,{path:"streak"}):console.error("Streak tracker elements not found")}(W),function(e){A=e.choreModal,j=e.closeModalBtn,F=e.addChoreBtn,P=e.addChoreSubmitBtn,O=e.choreDescriptionInput,H=e.chorePointsInput,A&&j&&F&&P&&O&&H?(F&&F.addEventListener("click",Y),j&&j.addEventListener("click",z),P&&P.addEventListener("click",R),A&&A.addEventListener("click",(e=>{e.target===A&&z()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&A&&"flex"===A.style.display&&z(),"Enter"===e.key&&document.activeElement===O&&R()}))):console.error("Chore modal elements not found")}(W),function(){const e=document.createElement("div");e.className="archive-indicator",e.style.display="none",W.questContainer.parentNode.insertBefore(e,W.questContainer.nextSibling),W.archiveIndicator=e;const t=document.createElement("button");t.className="archive-toggle",t.innerHTML='\n    <i class="ri-archive-line"></i>\n    <span>Show Archive</span>\n  ',W.questContainer.parentNode.insertBefore(t,W.questContainer.nextSibling),W.archiveToggle=t}(),V(),q(),W.filterButtons.forEach((e=>{e.addEventListener("click",(()=>{W.filterButtons.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),r({activeFilter:e.dataset.filter},"filterButtonClick"),V()}))})),W.recentFilterText?.addEventListener("click",_),W.archiveToggle&&W.archiveToggle.addEventListener("click",K),i(((e,t,n)=>{(n.changedPaths.includes("tasks")||n.changedPaths.includes("activeFilter")||n.changedPaths.includes("showRecentOnly")||n.changedPaths.includes("showArchive"))&&V(),n.changedPaths.includes("students")&&function(){const{students:e}=a();if(!e||0===e.length)return;const t=e[0];W.studentNameEl&&t.name&&(W.studentNameEl.textContent=t.name),W.studentPointsEl&&void 0!==t.points&&(W.studentPointsEl.textContent=t.points)}()})),document.addEventListener("task-completed",(()=>{q()}))}catch(e){console.error("Error initializing app:",e),alert("Could not connect to the database. Please check your internet connection and try again.")}finally{J(!1)}var e;window.addEventListener("beforeunload",(()=>{try{localStorage.setItem("scrollPosition",window.scrollY)}catch(e){console.error("Error accessing localStorage:",e)}}))}function K(){if(!W.archiveToggle)return;const{showArchive:e}=a();r({showArchive:!e},"toggleArchiveView");const t=W.archiveToggle.querySelector("span");t&&(t.textContent=e?"Show Archive":"Show Current");const n=W.archiveToggle.querySelector("i");n&&(n.className=e?"ri-archive-line":"ri-archive-fill"),W.archiveToggle.classList.toggle("active",!e),V()}function V(){if(!W.questContainer)return;const e=w(),{activeFilter:t,showRecentOnly:o,showArchive:s}=a(),{tasks:r,archiveCount:i}=function(e={}){const{filter:t="all",showRecentOnly:n=!1,showArchive:o=!1}=e,s=a().tasks||[],r=(w(),s.filter((e=>{const o=e.dueDate;if(!o)return!1;if(n){const e=k(o),t=new Date,n=Math.abs(t-e);if(Math.ceil(n/864e5)>14)return!1}return"subjects"===t?"subject"===e.type:"chores"!==t||"chore"===e.type}))),{current:i,archive:c}=function(e){const t=[],n=[],o=new Date;o.setHours(0,0,0,0);const s=new Date(o);return s.setDate(o.getDate()-14),e.forEach((e=>{const o=e.completed&&e.completedDate||e.dueDate;if(!o)return void t.push(e);const a=k(o);a?(a.setHours(0,0,0,0),e.completed&&a<s?n.push(e):t.push(e)):t.push(e)})),{current:t,archive:n}}(r);return{tasks:o?c:i,archiveCount:c.length,currentCount:i.length}}({filter:t,showRecentOnly:o,showArchive:s});if(W.questContainer.innerHTML="",function(e){W.archiveIndicator&&(e>0?(W.archiveIndicator.style.display="block",W.archiveIndicator.innerHTML=`\n      <i class="ri-archive-line"></i>\n      ${e} task${1===e?"":"s"} in archive\n    `):W.archiveIndicator.style.display="none")}(i),0!==r.length){if(W.noQuestsMessage.style.display="none","subjects"===t){const e=function(e){return e.filter((e=>"subject"===e.type&&!e.completed)).reduce(((e,t)=>t.subject?(e[t.subject]||(e[t.subject]=[]),e[t.subject].push(t),e):e),{})}(r);!function(e){const t=Object.keys(e);0!==t.length?(t.sort(((e,t)=>{const o=n(e),s=n(t);return o.found&&s.found?o.daysUntil-s.daysUntil:o.found?-1:s.found?1:e.localeCompare(t)})),t.forEach((t=>{const o=function(e,t,n,o){const s=document.createElement("div");s.className="quest-day subject-group",s.dataset.subject=e;const a=document.createElement("div");a.className="quest-day-header";let r="Not scheduled";n&&n.found&&(r=0===n.daysUntil?"Today":1===n.daysUntil?"Tomorrow":`${n.dayName} (in ${n.daysUntil} days)`),a.innerHTML=`\n    <h3 class="quest-day-title">${e}</h3>\n    <div class="next-class-info">Next: ${r}</div>\n  `,s.appendChild(a);const i=document.createElement("div");return i.className="quest-list",t.forEach((e=>{const t=D(e,(t=>{o&&o(t),c("task-completed",{taskId:t,task:e})}));i.appendChild(t)})),s.appendChild(i),s}(t,e[t],n(t),(e=>{console.log(`Task ${e} completed`)}));W.questContainer.appendChild(o)}))):W.questContainer.appendChild(function(e="No tasks found"){const t=document.createElement("div");return t.className="empty-state-container",t.style.display="flex",t.innerHTML=`\n    <div class="empty-state-content">\n      <i class="ri-emotion-happy-line"></i>\n      <h3>All done!</h3>\n      <p>${e}</p>\n    </div>\n  `,t}("No subject tasks found"))}(e)}else{const t=function(e){return w(),e.reduce(((e,t)=>t.dueDate?(e[t.dueDate]||(e[t.dueDate]=[]),e[t.dueDate].push(t),e):e),{})}(r);!function(e,t){Object.keys(e).sort(((e,t)=>new Date(e.split(".").reverse().join("-"))-new Date(t.split(".").reverse().join("-")))).forEach((n=>{const o=function(e,t,n,o){const s=document.createElement("div");s.className="quest-day",s.dataset.date=e;let a="",r=e;0===E(e,w())?(a="today",r="Today"):function(e){const t=k(w()),n=new Date(t);return n.setDate(n.getDate()+1),0===E(e,`${n.getDate().toString().padStart(2,"0")}.${(n.getMonth()+1).toString().padStart(2,"0")}.${n.getFullYear()}`)}(e)?(a="tomorrow",r="Tomorrow"):r=function(e,t=w()){const n=E(e,t);if(0===n)return"Today";const o=k(e),s=k(t),a=Math.abs(o-s),r=Math.ceil(a/864e5);return 1===n?1===r?"Tomorrow":r<7?`In ${r} days`:e:1===r?"Yesterday":r<7?`${r} days ago`:e}(e,n);const i=document.createElement("div");i.className=`quest-day-header ${a}`,i.innerHTML=`<h3 class="quest-day-title">${r}</h3>`,s.appendChild(i);const l=document.createElement("div");return l.className="quest-list",t.forEach((e=>{const t=D(e,(t=>{o&&"function"==typeof o&&o(t),c("task-completed",{taskId:t,task:e})}));l.appendChild(t)})),s.appendChild(l),s}(n,e[n],t,(e=>{console.log(`Task ${e} completed`)}));W.questContainer.appendChild(o)}))}(t,e)}!function(e,t=null){if(!S||!L)return void console.error("Today tasks elements not initialized. Call initTodayTasks first.");t||(t=w()),S.innerHTML="";const n=e.filter((e=>e.dueDate===t&&!e.completed));0!==n.length?(L.style.display="none",n.forEach((e=>{const t=D(e,(t=>{(function(e){if(!S||!L)return;const t=S.querySelector(`.quest-card[data-id="${e}"]`);if(t&&t.remove(),0===S.children.length){L.style.display="flex";const e=L.querySelector(".celebration-text");e&&(e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3))}})(t),c("today-task-completed",{taskId:t,task:e})}));t.classList.add("today-task-card"),S.appendChild(t)}))):L.style.display="flex"}(a().tasks,e)}else W.noQuestsMessage.style.display="flex"}function _(){const{showRecentOnly:e}=a();if(r({showRecentOnly:!e},"toggleRecentFilter"),W.recentFilterText){W.recentFilterText.textContent=e?"Recent Only":"Show All";const t=W.recentFilterText.previousElementSibling;t&&t.classList.contains("ri-time-line")&&(t.className=e?"ri-time-line":"ri-calendar-line")}}document.addEventListener("DOMContentLoaded",Q),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Q):Q()})();
//# sourceMappingURL=bundle.js.map